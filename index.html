<html>
    <head>
        <title>Sanders fruitfly</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
    </head>
    <body>
        <div class="container text-center">
            <div class="row" style="height: calc(100% - 150px);">
                <div class="col">
                    <b>Editor</b>
                    <br/>
                    <br/>
                    <textarea style="width: 100%; height: calc(100% - 50px)" id="thing"></textarea>
                    <br/>
                    <br/>
                    <label id="mylabel" style="color:red"></label>
                    <a id="downloadlink" type="button" class="btn btn-info disabled">Download file</a>
                </div>
                <div class="col">
                    <b>Emulator</b>
                    <br/>
                    <br/>
                    <div class="input-group mb-3">
                        <button class="btn btn-outline-secondary" type="button" id="inputGroupFileAddon03">Use from editor</button>
                        <span class="input-group-text">OR</span>
                        <input type="file" class="form-control" id="inputGroupFile03" aria-describedby="inputGroupFileAddon03" aria-label="Upload">
                      </div>
                    <br/>
                    <canvas id="canvasid"></canvas>
                </div>
            </div>
        </div>
        
        <script src="/js/compiler.js"></script>
        <script src="/js/emulator.js"></script>
        <script>

            window.fruitflysession = new FruitflyCompilerEditor(document.getElementById("thing"),document.getElementById("mylabel"),document.getElementById("downloadlink"));
            window.fruitflysession.attach();

            window.fruitflyemulator = new FruitflyEmulator(document.getElementById("canvasid"));
            document.getElementById("inputGroupFileAddon03").addEventListener("click",function(){
                window.fruitflyemulator.insertCardridge(window.fruitflysession.generateUint16DataArray());
            });
            document.getElementById("inputGroupFile03").addEventListener("change",function(evt){
                var file = evt.target.files[0];
                let reader = new FileReader();
                reader.addEventListener("loadend", function(e){
                    var data = new Uint16Array(e.target.result);
                    window.fruitflyemulator.insertCardridge(data);
                });
                reader.readAsArrayBuffer(file);
            });

        </script>
    </body>
</html>